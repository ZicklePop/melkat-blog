---
import Layout from './base-layout.astro'
import Article from '../components/article.astro'
import { title as blogTitle } from '../consts/config'
import type { CollectionEntry } from 'astro:content'

export interface Props {
  post: CollectionEntry<'posts'>
}

const { post } = Astro.props
const {
  data: { title, cover, date, link, tags },
  slug,
} = post

const permalink = `/p/${slug}`
const isPermalink = `${Astro.url}`.indexOf('/p/') > -1
const Component = isPermalink ? Layout : Fragment
const { Content } = await post.render()
---

<Component
  cover={cover}
  description={post.body.split('\n')[0]}
  permalink={permalink}
  title={`${blogTitle} - ${title}`}
>
  <Article
    cover={cover}
    date={date}
    link={link}
    tags={tags}
    title={title}
    url={permalink}
  >
    <Content />
  </Article>
</Component>
