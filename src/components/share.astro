---
import Icon from './icon.astro'
import { cxs } from '../consts/config'

export interface Props {
  title: string
  url: string
}

const { title, url } = Astro.props
---

<share-btn data-title={title} data-url={url}>
  <button class={`${cxs.aIcon} group`} title={`Share this post`}
    ><Icon
      type="share"
      appendClass="motion-safe:transition-transform group-hover:scale-125 group-[.cursor-not-allowed]:scale-100"
    /> Share
  </button>
</share-btn>
<script>
  class ShareButton extends HTMLElement {
    constructor() {
      super()
      const { title, url } = this.dataset
      const canShare = navigator.share !== undefined
      const button = this.querySelector('button')
      const svg = button?.querySelector('svg')
      const path = button?.querySelector('svg path')
      if (!canShare) {
        button?.remove()
      }
      button?.addEventListener('click', () => {
        if (svg && path) {
          svg.classList.add('motion-safe:animate-single-ping')
          path.setAttribute('stroke', 'oklch(60.71% 0.2743 7.34)')
        }
        navigator.share({
          title,
          url,
        })
      })
    }
  }
  customElements.define('share-btn', ShareButton)
</script>
