---
import Layout from '../../layouts/base-layout.astro'
import PageHeader from '../../components/page-header.astro'
import PostLayout from '../../layouts/post-layout.astro'
import { getEntry } from 'astro:content'
import { getPostsByLikes } from '../../utils/db'
import { pageSize } from '../../consts/config'
import type { CollectionEntry } from 'astro:content'

export const prerender = false

const likes = await getPostsByLikes()
const results: CollectionEntry<'posts'>[] = await Promise.all(
  likes.map(async ({ slug }) => await getEntry('posts', slug))
)
---

<Layout title="melkat.blog - Most liked posts" permalink={'/l'}>
  <PageHeader>Most liked posts</PageHeader>
  {
    results
      ?.slice(0, pageSize)
      ?.map(entry => entry && <PostLayout post={entry} />)
  }
</Layout>
