---
import Layout from '../../layouts/base-layout.astro'
import { cxs, title } from '../../consts/config'
import { getTypesByCount } from '../../utils/get-posts'
import { noDrafts } from '../../utils/filter'

const cx = {
  div: `${cxs.prose} mb-8`,
}

let allPosts = await Astro.glob('../p/*.md')
allPosts = allPosts.filter(noDrafts)
const sortedData = getTypesByCount(allPosts)

---
<Layout
  title={`${title} - Posts by category`}
  permalink='/c'
>
  <div class={cx.div}>
    <h2>Posts by category</h2>
    <ul>
      {sortedData.map(({key, count}) => (
        <li>
          <a href={`/c/${key}`}>{key}</a>
          {count} posts
        </li>
      ))}
    </ul>
  </div>
</Layout>
