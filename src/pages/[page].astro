---
import Layout from '../layouts/base-layout.astro'
import PageNavigator from '../components/page-navigator.astro'
import { noDrafts } from '../utils/filter'
import { byDate } from '../utils/sort'
import { pageSize } from '../consts/config'
import { getMarkdownForRSS } from '../utils/get-markdown'

export async function getStaticPaths({ paginate, rss }) {
  let allPosts = await Astro.glob('./p/*.md')
  allPosts = allPosts.filter(noDrafts).sort(byDate)
  const items = await getMarkdownForRSS(allPosts)
  rss({
    title: 'melkat.blog',
    description: 'a blog by Melanie Kat',
    items,
  });

  return paginate(allPosts, { pageSize })
}

const { page } = Astro.props
---
<Layout
  title={`melkat.blog - page ${page.currentPage} of ${page.lastPage}`}
  permalink={`/${page.currentPage}`}
>
  {page.data.map(({ Content }) => <Content />)}
  <PageNavigator page={page} />
</Layout>
