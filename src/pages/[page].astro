---
import Layout from '../layouts/base-layout.astro'
import Article from '../components/article.astro'
import { byDate } from '../utils/sort'
import { pageSize } from '../consts/config'

export async function getStaticPaths({ paginate, rss }) {
  let allPosts = await Astro.fetchContent('./p/*.md')
  allPosts = allPosts.filter(o => !o.draft).sort(byDate)
  rss({
    title: 'melkat.blog',
    description: 'a blog by Melanie Kat',
    items: allPosts.map(item => ({
      title: item.title,
      description: item.content.html,
      link: item.url,
      pubDate: item.date,
    })),
  });

  return paginate(allPosts, {
    pageSize,
  })
}

const { page } = Astro.props
---
<Layout title={`melkat.blog - page ${page.currentPage} of ${page.lastPage}`}>
  {page.data.map(({ title, cover, link, domain, date, url, tags, type, content }) => <Article {title} {cover} {link} {domain} {date} {url} {tags} {type}><Fragment set:html={content.html}/></Article>)}
</Layout>
