---
import Layout from '../../layouts/base-layout.astro'
import { getDomainsByCount } from '../../utils/get-posts'
import { noDrafts } from '../../utils/filter'

const cx = {
  div: 'prose prose-melkat dark:prose-invert mb-8',
}

let allPosts = await Astro.fetchContent('../p/*.md')
allPosts = allPosts.filter(noDrafts)
const sortedData = getDomainsByCount(allPosts)

---
<Layout
  title='melkat.blog - Posts by domain'
  permalink='/d'
>
  <div class={cx.div}>
    <h2>Posts by domain</h2>
    <ul>
      {sortedData.map(({key, count}) => (
        <li>
          <a href={`/d/${key}`}>{key}</a>
          {count} posts
        </li>
      ))}
    </ul>
  </div>
</Layout>
