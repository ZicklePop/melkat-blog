---
import Layout from '../layouts/base-layout.astro'
import PageNavigator from '../components/page-navigator.astro'
import { byDate } from '../utils/sort'
import { noDrafts } from '../utils/filter'
import { pageSize } from '../consts/config'

let allPosts = await Astro.glob('./p/*.md')
allPosts = allPosts.sort(byDate).filter(noDrafts)
const lastPage = Math.ceil(allPosts.length / pageSize)
const page = {
  lastPage,
  url: {
    next: lastPage > 1 && '/2',
  },
}
---

<Layout>
  {allPosts.slice(0, pageSize).map(({ Content }) => <Content />)}
  <PageNavigator page={page} />
</Layout>
